(function(){ 	// Google Analytics App: Event Tracker
	
	//console.log('gaEventVersion:1.4.4'); 
	
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','GAEventApp');
	
	InitGAEventApp(); 
	
	function InitGAEventApp(){
		var trackGAEvent = setInterval(function(){try{jQuery().jquery;clearInterval(trackGAEvent);StartGAEventApp();}catch (err) {}}, 10);
	}
	
	function StartGAEventApp(){
		jQuery('.ga-event-app').each(function(){
		if(jQuery(this).attr('actioned')==1)
			{
				return; // this request was actioned - go back.
			}else{
				jQuery(this).attr('actioned','1');
				ActionGAEventApp(this);
			}
		});
	}
	
	/** https://support.google.com/analytics/answer/1136920?hl=en
	* Function that tracks a click on an outbound link in Google Analytics.
	* This function takes a valid URL string as an argument, and uses that URL string
	* as the event label.
	*/
	function ActionGAEventApp(GAEventItem){
		var gaEventParams = jQuery(GAEventItem).data('params');
		var gaDataAutoEvent = jQuery(GAEventItem).data('autoevent');
		if(gaDataAutoEvent===undefined){gaDataAutoEvent=1;}
		gaEventParams = gaEventParams.split(','); 
		var registeredEvents = 19;
		/* Attribute type
			[0]=Trackid from Google
			[1]=Search Term
			[2]=Active Expanders
			[3]=Active Limiters
			[4]=Active Facets
			[5]=Remove Expanders
			[6]=Remove Limiters
			[7]=Remove Facets
			[8]=Add Limiters
			[9]=Add Facets
			[10]=Click Custom Link
			[11]=Click Placard
			[12]=Click Search Options
			[13]=Click Search History
			[14]=Click Advanced Search
			[15]=Click Show More
			[16]=Click Detailed Record Tools
			[17]=Guest Access
			[18]=No Results Found
		*/
		for(var iRegisteredEvent=0;iRegisteredEvent<registeredEvents;iRegisteredEvent++){
			if(gaEventParams[iRegisteredEvent]===undefined){
				if(gaDataAutoEvent==1){gaEventParams.push(1);}else{gaEventParams.push(0);}
			}
		}
		
		//https://developers.google.com/analytics/devguides/collection/analyticsjs/advanced
		GAEventApp('create', gaEventParams[0], 'auto',{'name':gaEventParams[0].replace(/\-/g,'')});
		GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), 'pageview');
		
		//Get SearchTerm		
		var epSearchTerm = jQuery('.search-terms').text();
		if(epSearchTerm==''){ // Basic result list
			epSearchTerm = jQuery('#SearchTerm1').val();
			if(epSearchTerm==''){ // Advanced result list
				epSearchTerm = jQuery('#Searchbox1').val();				
			}			
		}
		
		//Determine Guest Mode
		var gaTrackGuestMode = '';
		if(gaEventParams[17]==1){
			if(jQuery('.guest-login').length>0){
				var gaTrackGuestMode = '[Guest] ';
			}
		}
		
		
		
		//if(typeof gaEventParams[1]=="undefined"){gaEventParams.push(0);}
		if(gaEventParams[1]==1)
		(function(){//EDSSearchTerm
			var noEDSResultsFound = "";
			if(typeof epSearchTerm!='undefined'){
					eventLabel = QueryString('sid'); 
					if(document.location.pathname=="/eds/detail/detail"){
						itemTitle = jQuery('.citation-title').text().trim();
						if(itemTitle==''){itemTitle=jQuery('.ft-title').text().trim();}
						eventLabel = document.location.href.substring(document.location.href.indexOf('#'))+ ' Title: '+itemTitle;
					}
					if(gaEventParams[18]==1){
						if(jQuery(".std-warning-text").text()=="No results were found."){
							noEDSResultsFound = "[No Results]";
						}
					}
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
					'hitType': 'event',          // Required.
					'eventCategory': 'EBSCO:Search Term '+noEDSResultsFound+GetLocationPath(document.location.pathname),   // Required.
					'eventAction': gaTrackGuestMode+epSearchTerm,      // Required.
					'eventLabel': eventLabel,
					'eventValue': 1
				});
			}
		}());
	
		if((gaEventParams[2]==1) || (gaEventParams[3]==1) || (gaEventParams[4]==1))	
		(function(){//Active Expanders, Limiters and Facets
			if((document.URL.indexOf("/results?")>-1) || (document.URL.indexOf("/resultsadvanced?")>-1) ){
				var edsActiveExpanders='';
				var edsActiveLimiters='';
				var edsActiveFacets='';
				
				jQuery('.selected-limiters .limiter').each(function(){
					var currentCategory = jQuery(this).parent().parent().parent().find('.bb-heading').text();
					if(currentCategory=='Expanders'){
						edsActiveExpanders += currentCategory+': '+jQuery(this).text()+' , ';
					}else if(currentCategory=='Limiters'){
						edsActiveLimiters += currentCategory+': '+jQuery(this).text()+' , ';
					}else{
						edsActiveFacets += currentCategory+': '+jQuery(this).text()+' , ';	
					}
				});
				
				if(gaEventParams[2]==1) // Active Expanders
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Active Expanders '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+edsActiveExpanders,      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
				
				if(gaEventParams[3]==1) // Active Limiters
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Active Limiters '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+edsActiveLimiters,      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
				
				if(gaEventParams[4]==1) // Active Facets
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Active Facets '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+edsActiveFacets,      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}
		}());
		
		
		
		if((gaEventParams[5]==1) || (gaEventParams[6]==1) || (gaEventParams[7]==1))
		(function(){//Remove Expanders, Limiters, Facets
			jQuery('.icon.remove').on('click', function() {
				var removeLimiter='EBSCO:Remove Facets ';
				var currentCategory = jQuery(this).parent().parent().parent().find('.bb-heading').text();
				var okToLog = gaEventParams[7];
				if(currentCategory=="Expanders"){
					removeLimiter='EBSCO:Remove Expander ';
					okToLog = gaEventParams[5];
				}else if(currentCategory=="Limiters"){
					removeLimiter='EBSCO:Remove Limiter ';
					okToLog = gaEventParams[6];
				}
				
				if(okToLog==1)
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': removeLimiter+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+currentCategory+': '+jQuery(this).next().text(),      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}); 
		}());
		
		
		if((gaEventParams[8]==1) || (gaEventParams[9]==1))
		(function(){//Add/Remove Limiters, Facets
			jQuery('.rl-limiters li input').on('click', function() {
				 TrackAddRemoveLimiterFacets(this,0);
			}); 
			jQuery('.rl-limiters li a').on('click', function() {
				 TrackAddRemoveLimiterFacets(this,1);
			}); 
			function TrackAddRemoveLimiterFacets(selectedItem,isLink){
				if(isLink==1){
					selectedItem = jQuery(selectedItem).parent().parent();
				}else{
					selectedItem = jQuery(selectedItem).parent();
				}
				var facetType = jQuery(selectedItem).parent().parent().parent().find('.rl-lim-heading').text();
				var okToLog = gaEventParams[9];
				var itemStatus = 'Add ';
				if(jQuery(selectedItem).find('input[type="checkbox"]').is(':checked')==false && isLink==0){
					itemStatus = 'Removed ';
				}
				var currentCategory = "EBSCO:"+itemStatus+"Facet ";
				if(facetType=='Limit To'){
					currentCategory = "EBSCO:"+itemStatus+"Limiter ";
					okToLog = gaEventParams[8];
				}
				
				if(okToLog==1)
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': currentCategory+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+facetType+': '+jQuery(selectedItem).find('a').text(), // +' '+jQuery(this).find('span').text(),      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				});
			}
		}()); 
		
		
		
		if(gaEventParams[10]==1)
		(function(){//Click CustomLinks
			jQuery('.custom-link a').on('click', function() {
				var customLinkTitle = jQuery(this).parent().parent().parent().parent().find('.title-link').attr('title');
				if(document.URL.indexOf("/detail?")>-1){
					customLinkTitle = jQuery('.citation-title').text().trim();
					if(customLinkTitle==''){customLinkTitle=jQuery('.ft-title').text().trim();}
				}
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:[Custom Link]'+jQuery(this).attr('title')+' '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+'Title: '+customLinkTitle,      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}); 
			jQuery('.record-type.pdf-ft, .record-type.html-ft, .record-type.download').on('click', function() {
				var customLinkTitle = jQuery(this).parent().parent().parent().find('.title-link').attr('title');
				if(document.URL.indexOf("/detail?")>-1){
					customLinkTitle = jQuery('.citation-title').text().trim();
					if(customLinkTitle==''){customLinkTitle=jQuery('.ft-title').text().trim();}
				}
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:[Custom Link]'+jQuery(this).attr('title')+' '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+'Title: '+customLinkTitle,      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}); 
		}());
		
		if(gaEventParams[11]==1)
		(function(){//Click Placard
			var placardIsReady = 0;
			StartPlacardTracking();
			jQuery( document ).ajaxComplete(function( event, xhr, settings ) {StartPlacardTracking();});
			function StartPlacardTracking(){
			  if (jQuery('.placard-body').length>0 ) {
				  if(placardIsReady==1){return;}else{placardIsReady=1;}
					jQuery('.placard-body a').on('click', function() {
						GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
						  'hitType': 'event',          // Required.
						  'eventCategory': 'EBSCO:Select '+jQuery('.placard-branding').text().trim()+' '+GetLocationPath(document.location.pathname),   // Required.
						  'eventAction': gaTrackGuestMode+jQuery('.placard-body .title-link').attr('title'),      // Required.
						  'eventLabel': 'Search Term: '+epSearchTerm,
						  'eventValue': 1
						}); 
					}); 
				}
			}
				
		}());
		
		if(gaEventParams[12]==1)
		(function(){//Click Search Options
			jQuery('#optionsItem').on('click', function() {
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Search Options '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+'Click'      // Required.
				  //'eventLabel': 'Search Term: '+epSearchTerm,
				  //'eventValue': 1
				}); 
			}); 
		}());
		
		if(gaEventParams[13]==1)
		(function(){//Click Search History
			jQuery('#history').on('click', function() {
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Search History '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+'Click',      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}); 
		}());
		
		
		if(gaEventParams[14]==1)
		(function(){//Click Advanced Search
			jQuery('#advanced').on('click', function() {
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Advanced Search '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+'Click',      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}); 
		}());
		
		
		if(gaEventParams[15]==1)
		(function(){//Click Show More
			jQuery('.controls a').on('click', function() {
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Click Show More '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+jQuery(this).parent().parent().parent().find('.rl-lim-heading').text(),      // Required.
				  'eventLabel': 'Search Term: '+epSearchTerm,
				  'eventValue': 1
				}); 
			}); 
		}());
		
		if(gaEventParams[16]==1)
		(function(){//Detailed Record Tools
			jQuery('.article-tools a').on('click', function() {
				itemTitle = jQuery('.citation-title').text().trim();
				if(itemTitle==''){itemTitle=jQuery('.ft-title').text().trim();}
				eventLabel = document.location.href.substring(document.location.href.indexOf('#')) +' '+ 'Title: '+itemTitle;
				GAEventApp((gaEventParams[0].replace(/\-/g,'')+'.send'), {
				  'hitType': 'event',          // Required.
				  'eventCategory': 'EBSCO:Detailed Record Tool '+GetLocationPath(document.location.pathname),   // Required.
				  'eventAction': gaTrackGuestMode+jQuery(this).text().trim(),      // Required.
				  'eventLabel': eventLabel,
				  'eventValue': 1
				}); 
			}); 
		}());
		
	}
	
	function QueryString(key) {
	   var re=new RegExp('(?:\\?|&)'+key+'=(.*?)(?=&|$)','gi');
	   var r=[], m;
	   while ((m=re.exec(document.location.search)) != null) r.push(m[1]);
	   return r;
	}
	
	function GetLocationPath(locationPath){
		if(locationPath.indexOf('/eds/')>-1){
			return locationPath;
		}else{
			return locationPath + ' ('+jQuery('#showAllLink').attr('title')+')';
		}
	}
	
	
}());